# 2 - Network Services Exploitation

## 21 - FTP

* Connect to ftp server
  * `ftp <ip>` and then login
* Check anonymous login (with nmap script ftp-anon or anonymous user)
* If you have a username try using it as password
* Brute force login
* Search exploit for vulnerable version

## 22 - SSH

* Connect to SSH
  * `ssh <username>@<ip>` and then login
* If you have a username try using it as password
* Brute force login
* Search exploit for vulnerable version

## 25 - SMTP

* Search exploit for vulnerable version
* Retrieve the hostname of the server (domain name)
  * ```
    root@debian:~# nc <ip> <port>
    220 openmailbox.xyz ESMTP Postfix: Welcome to our mail server.    <--- here (in the banner)
    helo whatyouwant                                                  <--- helo command
    250 openmailbox.xyz                                               <--- here
    ```
* Username Bruteforce
  * Automation:
    * `smtp-user-enum -U <path_to_wordlist> -t <ip>`
  *   Manual

      ```
      root@debian:~# nc <ip> <port>
      220 openmailbox.xyz ESMTP Postfix: Welcome to our mail server.
      VRFY  root
      252 2.0.0 root                                                 <--- Output if user exists
      VRFY  idontexists
      550 5.1.1 <idontexists>: Recipient address rejected: User unknown in local recipient table
      ```
  * NOTE: there are other command you can use such as `RCPT TO`

## 80 - WebDav

* With WebDav you can upload file. Normally it's necessary credentials
  * Bruteforce (it's simple HTTP Basic Authentication)
* You can automate the upload and execution of file
  * davtest
    * `davtest -auth <user>:<password> -url http://<ip>/<path_to_webdav>` : try to upload check if the extension is executed
    * `davtest --url http://<ip>/<path_to_webdav> -auth <user>:<password> -uploadfile /path/to/webshell.asp -uploadloc /destination/webshell.asp` : upload file
  * cadaver
    * `cadaver http://<ip>/<path_to_webdav>` and then login. PUT command to upload a file/shell\


## 80 - PHP

* Famous exploit: php\_cgi\_arg\_injection (up to version 5.3.12 and 5.4.2 )

## 139/445 - SMB | Samba

* If you have a username try using it as password
* Brute force login
* Search exploit for vulnerable version
* If v1 is enabled - EternalBlue exploit (check with nmap --> smb-protocols)
* List shared folders
  * `smbclient --no-pass -L //<IP>` Null user
  * `smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<IP>` If you omit the pwd, it will be prompted. With --pw-nt-hash, the pwd provided is the NT hash
    * Example: `smbclient -U 'admin%admin' -L //<IP>`
* Obtain Information
  * `enum4linux -a [-u "<username>" -p "<passwd>"] <IP>`
  * **NOTE: you can enumerate users!**
* Command execution (authenticated)
  * `smbmap -H <ip> -u <user> -p <pass> -x 'ipconfig'`
  * psexec (impacket or metasploit)
    * can be used to pass NTLM hashes as password
    * `python3 psexec.py Administrator@ip`

## 3306 - MYSQL

* Connect without password: `mysql -h <Hostname> -u root`
* Connect with password: `mysql -h <Hostname> -u root -p`
* If you have a username try using it as password
* Brute force login
  * Try with `root` default user

## 3389 - RDP

* Connect to RDP
  * `xfreerdp /v:<ip> /u:<username> /p:<password>`
* If you have a username try using it as password
* Brute force login
* Search exploit for vulnerable version
* If you are not sure that specific port runs rdp you can check with `auxiliary/scanner/rdp/rdp_scanner` or try to connect with xfreerdp

## 5985,5986 - WinRM

* If you have a username try using it as password
* Brute force login


**Other ports**

Most of the services identified by the Nmap scan are easily recognizable, however, it's possibile that there are a few open ports on a target system that do not have a service banner. To learn more about these port and the service running, we can perform banner grabbing with Netcat

* `netcat <ip> <port>`
