# Network Services Exploitation

## 21 - FTP

* Login with `ftp <ip>`
* Check anonymous login (with nmap script ftp-anon or anonymous user)
  * user: anonymous, password: \<blank>
* Brute force login
* Search exploit for vulnerable version

## 22 - SSH

* Login with `ssh <username>@<ip>`
* Brute force login
* Search exploit for vulnerable version

## 25 - SMTP

* Search exploit for vulnerable version
* Retrieve the hostname of the server (domain name)
  * ```sh
    francesco@debian:~$ nc <ip> <port>
    220 openmailbox.xyz ESMTP Postfix: Welcome to our mail server.    # here (in the banner)
    helo whatyouwant                                                  # helo command
    250 openmailbox.xyz                                               # here
    ```
* Username Bruteforce
  * Automation:
    * `smtp-user-enum -U <wordlist> -t <ip>`
  *   Manual

      ```sh
      francesco@debian:~$ nc <ip> <port>
      220 openmailbox.xyz ESMTP Postfix: Welcome to our mail server.
      VRFY  root
      252 2.0.0 root                                         # Output if user exists
      VRFY  idontexists
      550 5.1.1 <idontexists>: Recipient address rejected: User unknown in local recipient table
      ```
  * NOTE: there are other command you can use such as `RCPT TO`

## 80 - WebDav

* With WebDav you can upload file. Normally it's necessary credentials
  * Bruteforce (it's simple HTTP Basic Authentication)
* You can automate the upload and execution of file
  * davtest
    * Check what file type is executed: `davtest -auth <user>:<password> -url http://<ip>/<webdav_path>`
    * Upload file: `davtest --url http://<ip>/<webdav_path> -auth <user>:<password> -uploadfile webshell.asp -uploadloc /destination/webshell.asp`
  * cadaver
    * `cadaver http://<ip>/<webdav_path>` and then login. PUT command to upload a file/shell\\

## 80 - PHP

* Famous exploit: php\_cgi\_arg\_injection (up to version 5.3.12 and 5.4.2 )

## 139/445 - SMB | Samba

* List shared folders
  * `smbclient --no-pass -L //<ip>` Null user
  * `smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<ip>` If you omit the pwd, it will be prompted. With --pw-nt-hash, the pwd provided is the NT hash
    * Example: `smbclient -U 'admin%admin' -L //<ip>`
* Obtain Information
  * `enum4linux -a [-u "<username>" -p "<passwd>"] <ip>`
  * **NOTE: you can enumerate users!**
* Command execution (authenticated)
  * `smbmap -H <ip> -u <user> -p <pass> -x 'ipconfig'`
  * psexec (impacket or metasploit)
    * can be used to pass NT hashes as password
    * `python3 psexec.py Administrator@ip`
* Brute force login
* Search exploit for vulnerable version
* If v1 is enabled - EternalBlue exploit (check with nmap -> smb-protocols)

## 3306 - MYSQL

* ```sh
  mysql -h <hostname> -u root        # Connect without password
  mysql -h <hostname> -u root -p     # Connect with password
  ```
* Brute force login
  * Try with `root` default user

## 3389 - RDP

* Connect to RDP `xfreerdp /v:<ip> /u:<username> /p:<password>`
* Brute force login
* Search exploit for vulnerable version
* If you are not sure that specific port runs rdp you can check with `auxiliary/scanner/rdp/rdp_scanner` or try to connect with xfreerdp

## 5985,5986 - WinRM

* If you have a username try using it as password
* Brute force login

## Other ports

Most of the services identified by the Nmap scan are easily recognizable, however, it's possibile that there are a few open ports on a target system that do not have a service banner. To learn more about these port and the service running, we can perform banner grabbing with Netcat

* `netcat <ip> <port>`
