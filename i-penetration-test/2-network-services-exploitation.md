# Network Services Exploitation

## 21 - FTP

* Login with `ftp <ip>`
* Check anonymous login (with nmap script ftp-anon or anonymous user)
  * ```sh
    # User:password
    anonymous:anonymous
    anonymous:
    ftp:ftp
    ```
* Brute force login
* Search exploit for vulnerable version

## 22 - SSH

* Login with `ssh <username>@<ip>`
* Brute force login
* Search exploit for vulnerable version

Suggestion: if you use kali it is configured for Strong Security. You can easily configure "wide compatibility" (legacy key exchange algorithms and old ciphers enabled) with `kali-tweaks`  -> Hardening menu -> Wide Compatibility. More info: [https://www.kali.org/docs/general-use/ssh-configuration/#ssh-client-wide-compatibility-vs-strong-security](https://www.kali.org/docs/general-use/ssh-configuration/#ssh-client-wide-compatibility-vs-strong-security)

## 25 - SMTP

* Search exploit for vulnerable version
* Retrieve the hostname of the server (domain name)
  * ```sh
    francesco@debian:~$ nc <ip> <port>
    220 openmailbox.xyz ESMTP Postfix: Welcome.    # here (in the banner)
    helo whatyouwant                               # helo command
    250 openmailbox.xyz                            # here
    ```
* Username Bruteforce
  * Automation:
    * `smtp-user-enum -U <wordlist> -t <ip>`
  *   Manual

      ```sh
      francesco@debian:~$ nc <ip> <port>
      220 openmailbox.xyz ESMTP Postfix: Welcome.
      VRFY  root
      252 2.0.0 root                                 # Output if user exists
      VRFY  idontexists
      550 5.1.1 <idontexists>: Recipient address rejected: User unknown in local recipient table
      ```
  * NOTE: there are other command you can use such as `RCPT TO`

## 80 - WebDav

* With WebDav you can upload file. Normally it's necessary credentials
  * Bruteforce (it's simple HTTP Basic Authentication)
* You can automate the upload and execution of file
  * davtest
    * ```sh
      # Check what file type is executed
      davtest -auth <user>:<password> -url http://<ip>/<webdav_path>
      # Upload file
      davtest --url http://<ip>/<webdav_path> -auth <user>:<password> -uploadfile webshell.asp -uploadloc /destination/webshell.asp
      ```
  * cadaver
    * `cadaver http://<ip>/<webdav_path>` and then login. PUT command to upload a file/shell\\

## 80 - PHP

* Famous exploit: php\_cgi\_arg\_injection (up to version 5.3.12 and 5.4.2 )

## 139/445 - SMB | Samba

* List shared folders
  * `smbclient --no-pass -L //<ip>` Null user
  * `smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<ip>` If you omit the pwd, it will be prompted. With --pw-nt-hash, the pwd provided is the NT hash
    * Example: `smbclient -U 'admin%admin' -L //<ip>`
* Obtain Information
  * `enum4linux -a [-u "<username>" -p "<passwd>"] <ip>`
  * **NOTE: you can enumerate users!**
* Command execution (authenticated)
  * `smbmap -H <ip> -u <user> -p <pass> -x 'ipconfig'`
  * psexec (impacket or metasploit)
    * can be used to pass NT hashes as password
    * `python3 psexec.py Administrator@ip`
* Brute force login
* Search exploit for vulnerable version
* If v1 is enabled - EternalBlue exploit (check with nmap -> smb-protocols)

## 1521,1522,1529 - ORACLE DB

<details>

<summary>INTRODUCTION</summary>

In Oracle DB a **SID** is specific to a database, it is unique in an environment and 'points' to one, and only one, database in an environment. A **service name** can be associated with one or more SIDs.

In a RAC environment where each instance is uniquely named yet all can be accessed through the SERVICE\_NAME. \[Oracle Real Application Cluster (**RAC**) is a "share-everything" database architecture in which two or more Oracle RAC nodes are clustered together and share the same memory]

```
SID        SERVICE_NAME
test1      test
test2      test
```

All of those SIDs can be associated with the SERVICE\_NAME test, and if load balancing is configured, the listener will 'balance' the workload across all SIDs. However, if you want, you can connect to test1, you just need to NOT use the SERVICE\_NAME and use the SID.

</details>

```sh
# Oracle DB version
odat tnscmd -s <ip> --version

# Search valid SIDs (with default wordlist and bruteforce [default max-size 2 chars])
odat sidguesser -s <ip>

# Search valid SIDs with custom sids wordlist
odat sidguesser -s <ip> --sids-file sids.txt

# Search valid SNs (with default wordlist and bruteforce [default max-size 2 chars])
odat snguesser -s <ip>

# Search valid SNs with custom SNs wordlist
odat snguesser -s <ip> --service-name-file sn.txt
```

Find user credentials

* \[CVE-2012-3137] You need a valid SID and Oracle DB version is one of this (10.2.0.3, 10.2.0.4, 10.2.0.5, 11.1.0.7, 11.2.0.2,  11.2.0.3) you can obtain the session key and salt for arbitrary users.&#x20;
* \[Guess password] You need SID or SN

<pre class="language-sh"><code class="lang-sh"><strong># Guess password with SID/SN using default odat credentials
</strong>odat passwordguesser -s &#x3C;ip> -d &#x3C;SID>
odat passwordguesser -s &#x3C;ip> -n &#x3C;SN>
</code></pre>

## 3306 - MYSQL

```sh
# Local without pass
mysql -u root
# Local with pass
mysql -u root -p
# Remote without pass
mysql -h <hostname> -u root
# Remote with pass
mysql -h <hostname> -u root -p 
```

* Brute force login
  * Try with `root` default user

## 3389 - RDP

* Connect to RDP `xfreerdp /v:<ip> /u:<username> /p:<password>`
* Brute force login
* Search exploit for vulnerable version
* If you are not sure that specific port runs rdp you can check with `auxiliary/scanner/rdp/rdp_scanner` or try to connect with xfreerdp

## 5985,5986 - WinRM

* If you have a username try using it as password
* Brute force login

## Other ports

Most of the services identified by the Nmap scan are easily recognizable, however, it's possibile that there are a few open ports on a target system that do not have a service banner. To learn more about these port and the service running, we can perform banner grabbing with Netcat

* `netcat <ip> <port>`
